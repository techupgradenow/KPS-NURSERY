# Admin API URL Rewriting
# KPS Nursery

RewriteEngine On

# Pass Authorization header to PHP (required for Bearer tokens)
# This fixes 401 errors when Apache strips the Authorization header
SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1
RewriteCond %{HTTP:Authorization} ^(.*)$
RewriteRule .* - [E=HTTP_AUTHORIZATION:%1]

# Handle CORS preflight requests
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# If the request is for an existing file or directory, serve it directly
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Rewrite clean URLs with ID to PHP files
# /products/1 -> products.php?id=1
# /orders/123 -> orders.php?id=123
RewriteRule ^(products|orders|categories|customers|banners|popups)/([0-9]+)/?$ $1.php?id=$2 [QSA,L]

# Rewrite upload URLs with type
# /upload/banner -> upload.php?type=banner
# /upload/products -> upload.php?type=products
RewriteRule ^upload/([a-z]+)/?$ upload.php?type=$1 [QSA,L]

# Rewrite clean URLs without ID to PHP files
# /dashboard -> dashboard.php
# /products -> products.php
# /upload -> upload.php
RewriteRule ^(auth|dashboard|orders|products|categories|customers|banners|popups|upload)/?$ $1.php [QSA,L]

# Fallback: route everything else to index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]
